<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poznámky</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <nav class="menu">
      <ul class="menu-list">
        <li><a href="index.html">Můj blog</a></li>
        <li><a href="zpravy.html">Zprávy</a></li>
        <li><a href="poznamky.html">Poznámky</a></li>
        <li><a href="programy.html">Programy</a></li>
      </ul>
      <form class="vyhledavani" action="search.html" method="get">
        <input type="search" name="q" placeholder="Hledat na webu..." aria-label="Hledat na webu">
        <button type="submit">Hledat</button>
      </form>
    </nav>
  </header>

  <main class="obsah poznamky-layout">
    <h1>Poznámky</h1>

    <aside class="poznamky-panel-vlevo">
      <form class="poznamka-formular" id="poznamka-formular">
        <label for="poznamka-text" class="visually-hidden">Nová poznámka</label>
        <textarea id="poznamka-text" name="text" rows="4" placeholder="Nová poznámka…" required></textarea>
        <button type="submit">Uložit</button>
      </form>
    </aside>

    <section class="poznamky-mrizka" aria-label="Uložené poznámky">
      <div id="poznamky-list" class="poznamky-grid"></div>
    </section>
  </main>

  <footer class="patka">
    <nav class="patka-menu">
      <span>Kontakt</span>
      <span>email</span>
      <span>podmínky</span>
    </nav>
  </footer>

  <script>
    (function() {
      var STORAGE_KEY = 'poznamky-web';
      var form = document.getElementById('poznamka-formular');
      var textarea = document.getElementById('poznamka-text');
      var listEl = document.getElementById('poznamky-list');

      function loadPoznamky() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          return [];
        }
      }

      function savePoznamky(poznamky) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(poznamky));
      }

      function renderPoznamky() {
        var poznamky = loadPoznamky();
        listEl.innerHTML = '';
        poznamky.forEach(function(text, index) {
          var card = document.createElement('div');
          card.className = 'poznamka-karta';
          card.setAttribute('data-index', index);
          var preview = document.createElement('span');
          preview.className = 'poznamka-preview';
          preview.textContent = text.length > 50 ? text.slice(0, 50) + '…' : text;
          var full = document.createElement('span');
          full.className = 'poznamka-obsah';
          full.textContent = text;
          var delBtn = document.createElement('button');
          delBtn.type = 'button';
          delBtn.className = 'poznamka-smazat';
          delBtn.setAttribute('aria-label', 'Smazat');
          delBtn.textContent = '×';
          delBtn.addEventListener('click', function(ev) {
            ev.stopPropagation();
            var arr = loadPoznamky();
            arr.splice(index, 1);
            savePoznamky(arr);
            renderPoznamky();
          });
          card.appendChild(preview);
          card.appendChild(full);
          card.appendChild(delBtn);
          card.addEventListener('click', function(ev) {
            if (ev.target === delBtn) return;
            card.classList.toggle('otevrena');
          });
          listEl.appendChild(card);
        });
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        var text = (textarea.value || '').trim();
        if (!text) return;
        var poznamky = loadPoznamky();
        poznamky.push(text);
        savePoznamky(poznamky);
        textarea.value = '';
        renderPoznamky();
      });

      renderPoznamky();
    })();
  </script>
</body>
</html>
